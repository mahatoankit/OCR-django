{% extends 'base.html' %} {% block content %}
<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h3>My Citizenship OCR Results</h3>
    <a href="{% url 'upload_image' %}" class="btn btn-primary"
      >Upload New Image</a
    >
  </div>
  <div class="card-body">
    {% if uploads %}
    <div class="accordion" id="uploadsAccordion">
      {% for upload in uploads %}
      <div class="accordion-item mb-3">
        <h2 class="accordion-header" id="heading{{ upload.id }}">
          <button
            class="accordion-button collapsed"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#collapse{{ upload.id }}"
            aria-expanded="false"
            aria-controls="collapse{{ upload.id }}"
          >
            Citizenship #{{ upload.citizenship_no|default:"Unknown" }} - {{ upload.uploaded_at }}
          </button>
        </h2>
        <div
          id="collapse{{ upload.id }}"
          class="accordion-collapse collapse"
          aria-labelledby="heading{{ upload.id }}"
          data-bs-parent="#uploadsAccordion"
        >
          <div class="accordion-body">
            <div class="row">
              <div class="col-md-4">
                <img
                  src="{{ upload.image.url }}"
                  alt="Citizenship Image"
                  class="img-fluid mb-3"
                />
                <p class="text-muted">
                  Scanned on: {{
                  upload.scan_date|default:upload.uploaded_at|date:"Y-m-d" }}
                </p>
              </div>
              <div class="col-md-8">
                <h5>Extracted Data</h5>
                <div class="table-responsive">
                  <table class="table table-bordered">
                    <tbody>
                      <tr>
                        <th>Citizenship Number</th>
                        <td>
                          {{ upload.citizenship_no|default:"Not detected" }}
                        </td>
                      </tr>
                      <tr>
                        <th>Full Name</th>
                        <td>{{ upload.full_name|default:"Not detected" }}</td>
                      </tr>
                      <tr>
                        <th>Gender</th>
                        <td>{{ upload.gender|default:"Not detected" }}</td>
                      </tr>
                      <tr>
                        <th>Date of Birth</th>
                        <td>{{ upload.dob|default:"Not detected" }}</td>
                      </tr>
                      <tr>
                        <th>Birth Place</th>
                        <td>{{ upload.birth_place|default:"Not detected" }}</td>
                      </tr>
                      <tr>
                        <th>Permanent Address</th>
                        <td>
                          {{ upload.permanent_address|default:"Not detected" }}
                        </td>
                      </tr>
                      <tr>
                        <th>Father's Name</th>
                        <td>{{ upload.father_name|default:"Not detected" }}</td>
                      </tr>
                      <tr>
                        <th>Mother's Name</th>
                        <td>{{ upload.mother_name|default:"Not detected" }}</td>
                      </tr>
                      <tr>
                        <th>Spouse's Name</th>
                        <td>{{ upload.spouse_name|default:"Not detected" }}</td>
                      </tr>
                      <tr>
                        <th>Issue Date</th>
                        <td>{{ upload.issue_date|default:"Not detected" }}</td>
                      </tr>
                      <tr>
                        <th>Issuing Authority</th>
                        <td>{{ upload.authority|default:"Not detected" }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div class="mt-3">
                  <h6>Raw Extracted Data</h6>
                  <pre
                    class="border p-2 bg-light"
                    style="max-height: 200px; overflow-y: auto"
                  >
{{ upload.text_result|default:"No data detected" }}</pre
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="text-center">You haven't uploaded any citizenship images yet.</p>
    <div class="text-center mt-3">
      <a href="{% url 'upload_image' %}" class="btn btn-primary"
        >Upload Your First Image</a
      >
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
